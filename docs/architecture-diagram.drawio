<mxfile host="embed.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" version="29.3.6" pages="8">
  <diagram id="IPA-4rBEDlcztsOa1QDi" name="Strona-1">
    <mxGraphModel dx="2240" dy="879" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" value="Claude Watch — Architecture" vertex="1">
          <mxGeometry height="30" width="400" x="200" y="15" as="geometry" />
        </mxCell>
        <mxCell id="devices-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=center;spacingLeft=8;spacingTop=4;dashed=1;" value="Devices" vertex="1">
          <mxGeometry height="280" width="220" x="40" y="60" as="geometry" />
        </mxCell>
        <mxCell id="watch" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Galaxy Watch&#xa;(Wear OS)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="95" as="geometry" />
        </mxCell>
        <mxCell id="watch-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Voice recording · Audio playback&#xa;Relays all traffic via phone (DataLayer)" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="140" as="geometry" />
        </mxCell>
        <mxCell id="phone" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Android Phone&#xa;(Relay + Companion)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="185" as="geometry" />
        </mxCell>
        <mxCell id="phone-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Watch relay (DataLayer) · Tailscale VPN&#xa;Text/voice · Creature UI" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="230" as="geometry" />
        </mxCell>
        <mxCell id="dashboard" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Web Dashboard&#xa;(Vue.js 3)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="275" as="geometry" />
        </mxCell>
        <mxCell id="server-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=center;spacingLeft=8;spacingTop=4;dashed=1;" value="Server (Python)" vertex="1">
          <mxGeometry height="380" width="220" x="320" y="60" as="geometry" />
        </mxCell>
        <mxCell id="http" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="HTTP Server&#xa;:5566" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="95" as="geometry" />
        </mxCell>
        <mxCell id="http-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="/transcribe · /api/message&#xa;/api/config · /api/response · /api/audio" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="140" as="geometry" />
        </mxCell>
        <mxCell id="ws" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="WebSocket Server&#xa;:5567" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="175" as="geometry" />
        </mxCell>
        <mxCell id="ws-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="state · chat · history&#xa;permission · usage" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="220" as="geometry" />
        </mxCell>
        <mxCell id="wrapper" parent="1" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Claude Wrapper" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="260" as="geometry" />
        </mxCell>
        <mxCell id="wrapper-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Persistent process · JSON streaming&#xa;Callback system · Context tracking" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="300" as="geometry" />
        </mxCell>
        <mxCell id="hook" parent="1" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Permission Hook" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="335" as="geometry" />
        </mxCell>
        <mxCell id="hook-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="PreToolUse · Auto-approve safe ops&#xa;Route sensitive tools to user" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="375" as="geometry" />
        </mxCell>
        <mxCell id="claude-bg" parent="1" style="rounded=1;fillColor=#ede7f6;strokeColor=#000000;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="100" width="180" x="600" y="245" as="geometry" />
        </mxCell>
        <mxCell id="claude" parent="1" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;fontStyle=1;" value="Claude Code&#xa;(CLI Process)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="260" as="geometry" />
        </mxCell>
        <mxCell id="claude-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Tools: Bash, Read, Write,&#xa;Edit, Grep, Glob..." vertex="1">
          <mxGeometry height="30" width="140" x="620" y="305" as="geometry" />
        </mxCell>
        <mxCell id="ext-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=center;spacingLeft=8;spacingTop=4;dashed=1;" value="External Services" vertex="1">
          <mxGeometry height="150" width="180" x="600" y="60" as="geometry" />
        </mxCell>
        <mxCell id="deepgram-stt" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram STT&#xa;(Speech → Text)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="90" as="geometry" />
        </mxCell>
        <mxCell id="deepgram-tts" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram TTS&#xa;(Text → Speech)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="145" as="geometry" />
        </mxCell>
        <mxCell id="tmux" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="tmux session&#xa;claude-watch" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="365" as="geometry" />
        </mxCell>
        <mxCell id="e1" edge="1" parent="1" source="watch" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="http">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e1-label" connectable="0" parent="e1" style="edgeLabel;fontSize=9;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="DataLayer (BT)" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e1b" edge="1" parent="1" source="phone" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="http">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2" edge="1" parent="1" source="watch" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.3;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2-label" connectable="0" parent="e2" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" value="DataLayer relay" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2b" edge="1" parent="1" source="phone" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.7;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2c" edge="1" parent="1" source="dashboard" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=1;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3" edge="1" parent="1" source="http" style="endArrow=classic;strokeColor=#333333;exitX=1.001;exitY=0.328;entryX=0;entryY=0.5;edgeStyle=orthogonalEdgeStyle;exitDx=0;exitDy=0;exitPerimeter=0;jumpStyle=gap;" target="deepgram-stt">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3-label" connectable="0" parent="e3" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="audio" vertex="1">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" edge="1" parent="1" source="http" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.8;entryX=0;entryY=0.5;edgeStyle=orthogonalEdgeStyle;" target="deepgram-tts">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4-label" connectable="0" parent="e4" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="text" vertex="1">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint x="-8" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" edge="1" parent="1" source="wrapper" style="endArrow=classic;startArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;edgeStyle=orthogonalEdgeStyle;" target="claude">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e5-label" connectable="0" parent="e5" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="JSON stdin/stdout" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint x="-32" y="-20" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" edge="1" parent="1" source="hook" style="endArrow=classic;startArrow=classic;strokeColor=#e53935;exitX=0.5;exitY=0;entryX=0.5;entryY=1;curved=0;dashed=1;" target="wrapper">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e6-label" connectable="0" parent="e6" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#e53935;" value="PreToolUse" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" edge="1" parent="1" source="wrapper" style="endArrow=classic;strokeColor=#999999;exitX=1;exitY=1;entryX=0;entryY=0.5;dashed=1;edgeStyle=orthogonalEdgeStyle;" target="tmux">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="300" />
              <mxPoint x="570" y="385" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e7-label" connectable="0" parent="e7" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#999999;" value="output log" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint x="-20" y="24" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-bg" parent="1" style="rounded=1;fillColor=#fafafa;strokeColor=#cccccc;strokeWidth=1;" value="" vertex="1">
          <mxGeometry height="75" width="220" x="40" y="365" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" parent="1" style="text;fontSize=10;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#333333;" value="State Flow" vertex="1">
          <mxGeometry height="15" width="100" x="50" y="370" as="geometry" />
        </mxCell>
        <mxCell id="legend-flow" parent="1" style="text;fontSize=9;align=left;fillColor=none;strokeColor=none;fontColor=#666666;whiteSpace=wrap;" value="idle → listening → thinking → speaking → idle&#xa;&#xa;Broadcast to all clients via WebSocket" vertex="1">
          <mxGeometry height="45" width="200" x="50" y="388" as="geometry" />
        </mxCell>
        <mxCell id="2" parent="1" style="text;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" value="Claude Watch — Architecture" vertex="1">
          <mxGeometry height="30" width="400" x="200" y="15" as="geometry" />
        </mxCell>
        <mxCell id="3" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Devices" vertex="1">
          <mxGeometry height="280" width="220" x="40" y="60" as="geometry" />
        </mxCell>
        <mxCell id="4" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Galaxy Watch&#xa;(Wear OS)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="95" as="geometry" />
        </mxCell>
        <mxCell id="5" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Voice recording · Audio playback&#xa;Relays all traffic via phone (DataLayer)" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="140" as="geometry" />
        </mxCell>
        <mxCell id="6" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Android Phone&#xa;(Relay + Companion)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="185" as="geometry" />
        </mxCell>
        <mxCell id="7" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Watch relay (DataLayer) · Tailscale VPN&#xa;Text/voice · Creature UI" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="230" as="geometry" />
        </mxCell>
        <mxCell id="8" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Web Dashboard&#xa;(Vue.js 3)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="275" as="geometry" />
        </mxCell>
        <mxCell id="9" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Server (Python)" vertex="1">
          <mxGeometry height="380" width="220" x="320" y="60" as="geometry" />
        </mxCell>
        <mxCell id="10" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="HTTP Server&#xa;:5566" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="95" as="geometry" />
        </mxCell>
        <mxCell id="11" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="/transcribe · /api/message&#xa;/api/config · /api/response · /api/audio" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="140" as="geometry" />
        </mxCell>
        <mxCell id="12" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="WebSocket Server&#xa;:5567" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="175" as="geometry" />
        </mxCell>
        <mxCell id="13" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="state · chat · history&#xa;permission · usage" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="220" as="geometry" />
        </mxCell>
        <mxCell id="14" parent="1" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Claude Wrapper" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="260" as="geometry" />
        </mxCell>
        <mxCell id="15" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Persistent process · JSON streaming&#xa;Callback system · Context tracking" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="300" as="geometry" />
        </mxCell>
        <mxCell id="16" parent="1" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Permission Hook" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="335" as="geometry" />
        </mxCell>
        <mxCell id="17" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="PreToolUse · Auto-approve safe ops&#xa;Route sensitive tools to user" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="375" as="geometry" />
        </mxCell>
        <mxCell id="18" parent="1" style="rounded=1;fillColor=#ede7f6;strokeColor=#000000;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="100" width="180" x="600" y="230" as="geometry" />
        </mxCell>
        <mxCell id="19" parent="1" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;fontStyle=1;" value="Claude Code&#xa;(CLI Process)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="245" as="geometry" />
        </mxCell>
        <mxCell id="20" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Tools: Bash, Read, Write,&#xa;Edit, Grep, Glob..." vertex="1">
          <mxGeometry height="30" width="140" x="620" y="290" as="geometry" />
        </mxCell>
        <mxCell id="21" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="External Services" vertex="1">
          <mxGeometry height="150" width="180" x="600" y="60" as="geometry" />
        </mxCell>
        <mxCell id="22" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram STT&#xa;(Speech → Text)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="90" as="geometry" />
        </mxCell>
        <mxCell id="23" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram TTS&#xa;(Text → Speech)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="145" as="geometry" />
        </mxCell>
        <mxCell id="24" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="tmux session&#xa;claude-watch" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="365" as="geometry" />
        </mxCell>
        <mxCell id="25" edge="1" parent="1" source="4" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="26" connectable="0" parent="25" style="edgeLabel;fontSize=9;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="DataLayer (BT)" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="27" edge="1" parent="1" source="6" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="28" edge="1" parent="1" source="4" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.3;curved=1;strokeWidth=1;dashed=1;" target="12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="29" connectable="0" parent="28" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" value="DataLayer relay" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="30" edge="1" parent="1" source="6" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.7;curved=1;strokeWidth=1;dashed=1;" target="12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="31" edge="1" parent="1" source="8" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=1;curved=1;strokeWidth=1;dashed=1;" target="12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="36" edge="1" parent="1" source="14" style="endArrow=classic;startArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="37" connectable="0" parent="36" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="JSON stdin/stdout" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="38" edge="1" parent="1" source="16" style="endArrow=classic;startArrow=classic;strokeColor=#e53935;exitX=0.5;exitY=0;entryX=0.5;entryY=1;curved=0;dashed=1;" target="14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="39" connectable="0" parent="38" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#e53935;" value="PreToolUse" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="40" edge="1" parent="1" source="14" style="endArrow=classic;strokeColor=#999999;exitX=1;exitY=1;entryX=0;entryY=0.5;curved=1;dashed=1;" target="24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41" connectable="0" parent="40" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#999999;" value="output log" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="42" parent="1" style="rounded=1;fillColor=#fafafa;strokeColor=#cccccc;strokeWidth=1;" value="" vertex="1">
          <mxGeometry height="75" width="220" x="40" y="365" as="geometry" />
        </mxCell>
        <mxCell id="43" parent="1" style="text;fontSize=10;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#333333;" value="State Flow" vertex="1">
          <mxGeometry height="15" width="100" x="50" y="370" as="geometry" />
        </mxCell>
        <mxCell id="44" parent="1" style="text;fontSize=9;align=left;fillColor=none;strokeColor=none;fontColor=#666666;whiteSpace=wrap;" value="idle → listening → thinking → speaking → idle&#xa;&#xa;Broadcast to all clients via WebSocket" vertex="1">
          <mxGeometry height="45" width="200" x="50" y="388" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="System Architecture" id="LCdY6uRO-z8ZR-8ZUZxN">
    <mxGraphModel dx="1067" dy="419" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="500" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" value="Claude Watch — System Architecture" vertex="1">
          <mxGeometry height="30" width="400" x="200" y="15" as="geometry" />
        </mxCell>
        <mxCell id="devices-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Devices" vertex="1">
          <mxGeometry height="280" width="220" x="40" y="60" as="geometry" />
        </mxCell>
        <mxCell id="watch" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Galaxy Watch&#xa;(Wear OS)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="95" as="geometry" />
        </mxCell>
        <mxCell id="watch-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Voice recording · Audio playback&#xa;Relays all traffic via phone (DataLayer)" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="140" as="geometry" />
        </mxCell>
        <mxCell id="phone" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Android Phone&#xa;(Relay + Companion)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="185" as="geometry" />
        </mxCell>
        <mxCell id="phone-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Watch relay (DataLayer) · Tailscale VPN&#xa;Text/voice · Creature UI" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="230" as="geometry" />
        </mxCell>
        <mxCell id="dashboard" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Web Dashboard&#xa;(Vue.js 3)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="275" as="geometry" />
        </mxCell>
        <mxCell id="server-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=center;spacingLeft=8;spacingTop=4;dashed=1;" value="Server (Python)" vertex="1">
          <mxGeometry height="380" width="220" x="320" y="60" as="geometry" />
        </mxCell>
        <mxCell id="http" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="HTTP Server&#xa;:5566" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="95" as="geometry" />
        </mxCell>
        <mxCell id="http-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="/transcribe · /api/message&#xa;/api/config · /api/response · /api/audio" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="140" as="geometry" />
        </mxCell>
        <mxCell id="ws" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="WebSocket Server&#xa;:5567" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="175" as="geometry" />
        </mxCell>
        <mxCell id="ws-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="state · chat · history&#xa;permission · usage" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="220" as="geometry" />
        </mxCell>
        <mxCell id="wrapper" parent="1" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Claude Wrapper" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="260" as="geometry" />
        </mxCell>
        <mxCell id="wrapper-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Persistent process · JSON streaming&#xa;Callback system · Context tracking" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="300" as="geometry" />
        </mxCell>
        <mxCell id="hook" parent="1" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Permission Hook" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="335" as="geometry" />
        </mxCell>
        <mxCell id="hook-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="PreToolUse · Auto-approve safe ops&#xa;Route sensitive tools to user" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="375" as="geometry" />
        </mxCell>
        <mxCell id="claude-bg" parent="1" style="rounded=1;fillColor=#ede7f6;strokeColor=#000000;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="100" width="180" x="600" y="245" as="geometry" />
        </mxCell>
        <mxCell id="claude" parent="1" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;fontStyle=1;" value="Claude Code&#xa;(CLI Process)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="260" as="geometry" />
        </mxCell>
        <mxCell id="claude-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Tools: Bash, Read, Write,&#xa;Edit, Grep, Glob..." vertex="1">
          <mxGeometry height="30" width="140" x="620" y="305" as="geometry" />
        </mxCell>
        <mxCell id="ext-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=center;spacingLeft=8;spacingTop=4;dashed=1;" value="External Services" vertex="1">
          <mxGeometry height="150" width="180" x="600" y="60" as="geometry" />
        </mxCell>
        <mxCell id="deepgram-stt" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram STT&#xa;(Speech → Text)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="90" as="geometry" />
        </mxCell>
        <mxCell id="deepgram-tts" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram TTS&#xa;(Text → Speech)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="145" as="geometry" />
        </mxCell>
        <mxCell id="tmux" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="tmux session&#xa;claude-watch" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="365" as="geometry" />
        </mxCell>
        <mxCell id="e1" edge="1" parent="1" source="watch" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="http">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e1-label" connectable="0" parent="e1" style="edgeLabel;fontSize=9;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="DataLayer (BT)" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e1b" edge="1" parent="1" source="phone" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="http">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2" edge="1" parent="1" source="watch" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.3;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2-label" connectable="0" parent="e2" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" value="DataLayer relay" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2b" edge="1" parent="1" source="phone" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.7;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2c" edge="1" parent="1" source="dashboard" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=1;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3" edge="1" parent="1" source="http" style="endArrow=classic;strokeColor=#333333;exitX=1.001;exitY=0.337;entryX=0;entryY=0.5;edgeStyle=orthogonalEdgeStyle;exitDx=0;exitDy=0;exitPerimeter=0;" target="deepgram-stt">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3-label" connectable="0" parent="e3" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="audio" vertex="1">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint y="-15" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" edge="1" parent="1" source="http" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.8;entryX=0;entryY=0.5;edgeStyle=orthogonalEdgeStyle;" target="deepgram-tts">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4-label" connectable="0" parent="e4" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="text" vertex="1">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint x="-8" y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" edge="1" parent="1" source="wrapper" style="endArrow=classic;startArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="claude">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e5-label" connectable="0" parent="e5" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="JSON stdin/stdout" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint x="-22" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" edge="1" parent="1" source="hook" style="endArrow=classic;startArrow=classic;strokeColor=#e53935;exitX=0.5;exitY=0;entryX=0.5;entryY=1;curved=0;dashed=1;" target="wrapper">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e6-label" connectable="0" parent="e6" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#e53935;" value="PreToolUse" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" edge="1" parent="1" source="wrapper" style="endArrow=classic;strokeColor=#999999;exitX=1;exitY=1;entryX=0;entryY=0.5;curved=1;dashed=1;" target="tmux">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e7-label" connectable="0" parent="e7" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#999999;" value="output log" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-bg" parent="1" style="rounded=1;fillColor=#fafafa;strokeColor=#cccccc;strokeWidth=1;" value="" vertex="1">
          <mxGeometry height="75" width="220" x="40" y="365" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" parent="1" style="text;fontSize=10;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#333333;" value="State Flow" vertex="1">
          <mxGeometry height="15" width="100" x="50" y="370" as="geometry" />
        </mxCell>
        <mxCell id="legend-flow" parent="1" style="text;fontSize=9;align=left;fillColor=none;strokeColor=none;fontColor=#666666;whiteSpace=wrap;" value="idle → listening → thinking → speaking → idle&#xa;&#xa;Broadcast to all clients via WebSocket" vertex="1">
          <mxGeometry height="45" width="200" x="50" y="388" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Phone App Architecture" id="N6yx2lc757WN8aIQ4YOF">
    <mxGraphModel dx="1545" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="900" pageHeight="620" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="p-title" parent="1" style="text;fontSize=18;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" value="Phone App — Internal Architecture" vertex="1">
          <mxGeometry height="30" width="400" x="220" y="15" as="geometry" />
        </mxCell>
        <mxCell id="p-main-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="125" width="340" x="250" y="55" as="geometry" />
        </mxCell>
        <mxCell id="p-main" parent="1" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=13;fontStyle=1;align=center;whiteSpace=wrap;" value="MainActivity" vertex="1">
          <mxGeometry height="35" width="160" x="340" y="65" as="geometry" />
        </mxCell>
        <mxCell id="p-main-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Orchestrates all components&#xa;ViewBinding · LifecycleScope · Coroutines" vertex="1">
          <mxGeometry height="25" width="260" x="290" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p-main-feat" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#999999;" value="sendTextMessage() · sendAudioToServer()&#xa;respondToPrompt() · respondToPermission()&#xa;updateCreatureState() · retryMessage()" vertex="1">
          <mxGeometry height="45" width="260" x="290" y="125" as="geometry" />
        </mxCell>
        <mxCell id="p-ui-bg" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="UI Layer" vertex="1">
          <mxGeometry height="190" width="370" x="40" y="210" as="geometry" />
        </mxCell>
        <mxCell id="p-creature" parent="1" style="rounded=1;fillColor=#ffcc80;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="CreatureView" vertex="1">
          <mxGeometry height="35" width="130" x="55" y="240" as="geometry" />
        </mxCell>
        <mxCell id="p-creature-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Custom View · Canvas drawing&#xa;Breathing, blink, bounce anims&#xa;States: idle/listen/think/speak/sleep/offline" vertex="1">
          <mxGeometry height="40" width="170" x="35" y="275" as="geometry" />
        </mxCell>
        <mxCell id="p-chat-adapter" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="ChatAdapter" vertex="1">
          <mxGeometry height="35" width="130" x="215" y="240" as="geometry" />
        </mxCell>
        <mxCell id="p-chat-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="ListAdapter + DiffUtil&#xa;User/Claude view types&#xa;Pending/Failed status + retry" vertex="1">
          <mxGeometry height="40" width="160" x="200" y="275" as="geometry" />
        </mxCell>
        <mxCell id="p-prompt-ui" parent="1" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Prompt / Permission UI" vertex="1">
          <mxGeometry height="35" width="160" x="55" y="325" as="geometry" />
        </mxCell>
        <mxCell id="p-prompt-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Dynamic option buttons&#xa;Tool name + context display" vertex="1">
          <mxGeometry height="25" width="160" x="55" y="360" as="geometry" />
        </mxCell>
        <mxCell id="p-context-bar" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Context Bar" vertex="1">
          <mxGeometry height="35" width="130" x="240" y="325" as="geometry" />
        </mxCell>
        <mxCell id="p-context-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Token usage %&#xa;Color: green → orange → red" vertex="1">
          <mxGeometry height="25" width="140" x="235" y="360" as="geometry" />
        </mxCell>
        <mxCell id="p-net-bg" parent="1" style="rounded=1;fillColor=#e8f5e9;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Network Layer" vertex="1">
          <mxGeometry height="190" width="200" x="450" y="210" as="geometry" />
        </mxCell>
        <mxCell id="p-ws" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;fontStyle=1;" value="WebSocketClient" vertex="1">
          <mxGeometry height="35" width="160" x="470" y="240" as="geometry" />
        </mxCell>
        <mxCell id="p-ws-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="OkHttp WebSocket&#xa;Auto-reconnect (5s delay)&#xa;30s ping interval" vertex="1">
          <mxGeometry height="40" width="160" x="470" y="275" as="geometry" />
        </mxCell>
        <mxCell id="p-flows" parent="1" style="rounded=1;fillColor=#c8e6c9;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="StateFlows" vertex="1">
          <mxGeometry height="35" width="160" x="470" y="325" as="geometry" />
        </mxCell>
        <mxCell id="p-flows-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="connectionStatus · claudeState&#xa;chatMessages · currentPrompt&#xa;contextUsage" vertex="1">
          <mxGeometry height="40" width="160" x="470" y="360" as="geometry" />
        </mxCell>
        <mxCell id="p-input-bg" parent="1" style="rounded=1;fillColor=#f3e5f5;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Input" vertex="1">
          <mxGeometry height="105" width="240" x="40" y="420" as="geometry" />
        </mxCell>
        <mxCell id="p-text-input" parent="1" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="Text Input" vertex="1">
          <mxGeometry height="30" width="95" x="55" y="445" as="geometry" />
        </mxCell>
        <mxCell id="p-text-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="EditText + Send btn&#xa;IME_ACTION_SEND" vertex="1">
          <mxGeometry height="25" width="115" x="45" y="475" as="geometry" />
        </mxCell>
        <mxCell id="p-voice" parent="1" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="Voice Input" vertex="1">
          <mxGeometry height="30" width="95" x="165" y="445" as="geometry" />
        </mxCell>
        <mxCell id="p-voice-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Hold-to-record&#xa;MediaRecorder → m4a" vertex="1">
          <mxGeometry height="25" width="115" x="155" y="475" as="geometry" />
        </mxCell>
        <mxCell id="p-util-bg" parent="1" style="rounded=1;fillColor=#fafafa;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Utility" vertex="1">
          <mxGeometry height="105" width="340" x="310" y="420" as="geometry" />
        </mxCell>
        <mxCell id="p-kiosk" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="KioskManager" vertex="1">
          <mxGeometry height="30" width="120" x="325" y="445" as="geometry" />
        </mxCell>
        <mxCell id="p-kiosk-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Immersive fullscreen&#xa;3x corner-tap to exit" vertex="1">
          <mxGeometry height="25" width="130" x="320" y="475" as="geometry" />
        </mxCell>
        <mxCell id="p-settings" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="SettingsActivity" vertex="1">
          <mxGeometry height="30" width="120" x="460" y="445" as="geometry" />
        </mxCell>
        <mxCell id="p-settings-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Server address&#xa;Kiosk · Auto-retry prefs" vertex="1">
          <mxGeometry height="25" width="140" x="450" y="475" as="geometry" />
        </mxCell>
        <mxCell id="p-pending" parent="1" style="rounded=1;fillColor=#fff9c4;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;whiteSpace=wrap;" value="Pending Messages&#xa;MutableStateFlow" vertex="1">
          <mxGeometry height="35" width="140" x="690" y="325" as="geometry" />
        </mxCell>
        <mxCell id="p-pending-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Queue unsent messages&#xa;Retry on reconnect&#xa;Merge with server msgs" vertex="1">
          <mxGeometry height="40" width="140" x="690" y="360" as="geometry" />
        </mxCell>
        <mxCell id="p-server" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;fontStyle=1;" value="Server&#xa;HTTP :5566 / WS :5567" vertex="1">
          <mxGeometry height="45" width="140" x="690" y="100" as="geometry" />
        </mxCell>
        <mxCell id="p-okhttp" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" value="OkHttpClient" vertex="1">
          <mxGeometry height="30" width="120" x="700" y="210" as="geometry" />
        </mxCell>
        <mxCell id="p-okhttp-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="POST /transcribe&#xa;POST /api/message&#xa;POST /api/permission/respond" vertex="1">
          <mxGeometry height="35" width="140" x="690" y="240" as="geometry" />
        </mxCell>
        <mxCell id="pe4" edge="1" parent="1" source="p-ws" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=0.5;exitY=0;entryX=0;entryY=0.5;curved=1;dashed=1;entryDx=0;entryDy=0;" target="p-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe4-label" connectable="0" parent="pe4" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" value="WebSocket" vertex="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pe5" edge="1" parent="1" source="p-okhttp" style="endArrow=classic;strokeColor=#333333;exitX=0.5;exitY=0;entryX=0.5;entryY=1;curved=1;" target="p-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe5-label" connectable="0" parent="pe5" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="HTTP" vertex="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pe6" edge="1" parent="1" source="p-flows" style="endArrow=classic;strokeColor=#999999;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=0;dashed=1;" target="p-pending">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe6-label" connectable="0" parent="pe6" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#999999;" value="combine()" vertex="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-20" as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Watch App Architecture" id="bbXd6aU9RM7iOMLDPIOC">
    <mxGraphModel dx="1545" dy="606" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="900" pageHeight="620" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="w-title" parent="1" style="text;fontSize=18;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" value="Watch App — Internal Architecture" vertex="1">
          <mxGeometry height="30" width="400" x="220" y="15" as="geometry" />
        </mxCell>
        <mxCell id="w-main-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="125" width="380" x="230" y="55" as="geometry" />
        </mxCell>
        <mxCell id="w-main" parent="1" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=13;fontStyle=1;align=center;whiteSpace=wrap;" value="MainActivity" vertex="1">
          <mxGeometry height="35" width="160" x="340" y="65" as="geometry" />
        </mxCell>
        <mxCell id="w-main-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Activity · Orchestrates all components&#xa;CoroutineScope · collectFlows()" vertex="1">
          <mxGeometry height="25" width="260" x="290" y="100" as="geometry" />
        </mxCell>
        <mxCell id="w-main-feat" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#999999;" value="toggleRecording() · stopRecordingAndSend()&#xa;fetchAudioForRequest() · downloadAndPlayAudio()&#xa;showPrompt() · respondToPermission() · sendAck()" vertex="1">
          <mxGeometry height="45" width="300" x="270" y="125" as="geometry" />
        </mxCell>
        <mxCell id="w-rec-bg" parent="1" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Voice Recording" vertex="1">
          <mxGeometry height="130" width="190" x="40" y="210" as="geometry" />
        </mxCell>
        <mxCell id="w-recorder" parent="1" style="rounded=1;fillColor=#ef9a9a;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="MediaRecorder" vertex="1">
          <mxGeometry height="30" width="150" x="60" y="240" as="geometry" />
        </mxCell>
        <mxCell id="w-rec-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="AAC / MPEG-4 @ 44.1kHz&#xa;128kbps · Temp .m4a file&#xa;Record button toggles state" vertex="1">
          <mxGeometry height="45" width="170" x="50" y="275" as="geometry" />
        </mxCell>
        <mxCell id="w-play-bg" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Audio Playback" vertex="1">
          <mxGeometry height="130" width="190" x="40" y="365" as="geometry" />
        </mxCell>
        <mxCell id="w-player" parent="1" style="rounded=1;fillColor=#90caf9;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="MediaPlayer" vertex="1">
          <mxGeometry height="30" width="150" x="60" y="395" as="geometry" />
        </mxCell>
        <mxCell id="w-play-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Download MP3 from server&#xa;Replay / Pause / Done controls&#xa;ACK sent on completion" vertex="1">
          <mxGeometry height="45" width="170" x="50" y="430" as="geometry" />
        </mxCell>
        <mxCell id="w-ui-bg" parent="1" style="rounded=1;fillColor=#e8f5e9;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="UI Components" vertex="1">
          <mxGeometry height="285" width="200" x="265" y="210" as="geometry" />
        </mxCell>
        <mxCell id="w-state-pill" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="State Indicator Pill" vertex="1">
          <mxGeometry height="30" width="160" x="285" y="240" as="geometry" />
        </mxCell>
        <mxCell id="w-state-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="RECORDING (red) · THINKING (orange)&#xa;SPEAKING (blue) · hidden when idle" vertex="1">
          <mxGeometry height="25" width="180" x="275" y="270" as="geometry" />
        </mxCell>
        <mxCell id="w-chat" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="WatchChatAdapter" vertex="1">
          <mxGeometry height="30" width="160" x="285" y="305" as="geometry" />
        </mxCell>
        <mxCell id="w-chat-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="WearableRecyclerView&#xa;Overlapping bubbles (-6dp)&#xa;Thinking dots indicator" vertex="1">
          <mxGeometry height="35" width="180" x="275" y="335" as="geometry" />
        </mxCell>
        <mxCell id="w-prompt" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="Prompt Overlay" vertex="1">
          <mxGeometry height="30" width="160" x="285" y="380" as="geometry" />
        </mxCell>
        <mxCell id="w-prompt-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Permission Allow/Deny&#xa;Dynamic option buttons&#xa;Fade-in animation + haptics" vertex="1">
          <mxGeometry height="35" width="180" x="275" y="410" as="geometry" />
        </mxCell>
        <mxCell id="w-anim" parent="1" style="rounded=1;fillColor=#c8e6c9;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" value="Animations" vertex="1">
          <mxGeometry height="25" width="160" x="285" y="455" as="geometry" />
        </mxCell>
        <mxCell id="w-anim-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="animateIn/Out · fadeIn/Out · OvershootInterpolator" vertex="1">
          <mxGeometry height="15" width="180" x="275" y="480" as="geometry" />
        </mxCell>
        <mxCell id="w-net-bg" parent="1" style="rounded=1;fillColor=#f3e5f5;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Network Layer" vertex="1">
          <mxGeometry height="190" width="200" x="500" y="210" as="geometry" />
        </mxCell>
        <mxCell id="w-ws" parent="1" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;fontStyle=1;" value="WatchWebSocketClient" vertex="1">
          <mxGeometry height="35" width="170" x="515" y="240" as="geometry" />
        </mxCell>
        <mxCell id="w-ws-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="OkHttp WebSocket&#xa;Auto-reconnect (5s)&#xa;30s ping interval" vertex="1">
          <mxGeometry height="35" width="160" x="520" y="275" as="geometry" />
        </mxCell>
        <mxCell id="w-flows" parent="1" style="rounded=1;fillColor=#e1bee7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="StateFlows" vertex="1">
          <mxGeometry height="35" width="170" x="515" y="320" as="geometry" />
        </mxCell>
        <mxCell id="w-flows-d" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="connectionStatus · claudeState&#xa;chatMessages · currentPrompt&#xa;contextUsage" vertex="1">
          <mxGeometry height="40" width="160" x="520" y="355" as="geometry" />
        </mxCell>
        <mxCell id="w-models" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" value="Models.kt" vertex="1">
          <mxGeometry height="30" width="170" x="515" y="455" as="geometry" />
        </mxCell>
        <mxCell id="w-models-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="ChatMessage · ClaudeState · ContextUsage&#xa;ClaudePrompt · PromptOption · ConnectionStatus" vertex="1">
          <mxGeometry height="25" width="190" x="505" y="485" as="geometry" />
        </mxCell>
        <mxCell id="w-server" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;fontStyle=1;" value="Server&#xa;HTTP :5566 / WS :5567" vertex="1">
          <mxGeometry height="45" width="140" x="720" y="100" as="geometry" />
        </mxCell>
        <mxCell id="w-okhttp" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" value="OkHttpClient" vertex="1">
          <mxGeometry height="30" width="120" x="730" y="260" as="geometry" />
        </mxCell>
        <mxCell id="w-okhttp-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="POST /transcribe (audio)&#xa;GET /api/response&#xa;GET /api/audio&#xa;POST /api/permission/respond&#xa;POST /api/response/ack" vertex="1">
          <mxGeometry height="55" width="150" x="715" y="290" as="geometry" />
        </mxCell>
        <mxCell id="w-haptics" parent="1" style="rounded=1;fillColor=#fff9c4;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" value="Vibrator (Haptics)" vertex="1">
          <mxGeometry height="30" width="120" x="730" y="355" as="geometry" />
        </mxCell>
        <mxCell id="w-haptics-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Record start/stop&#xa;Permission prompt&#xa;Error patterns" vertex="1">
          <mxGeometry height="35" width="130" x="725" y="385" as="geometry" />
        </mxCell>
        <mxCell id="w-settings" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" value="SettingsActivity" vertex="1">
          <mxGeometry height="30" width="120" x="730" y="455" as="geometry" />
        </mxCell>
        <mxCell id="w-settings-d" parent="1" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Server IP + Port&#xa;SharedPreferences" vertex="1">
          <mxGeometry height="20" width="120" x="730" y="485" as="geometry" />
        </mxCell>
        <mxCell id="we4" edge="1" parent="1" source="w-ws" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.3;entryX=0.25;entryY=1;curved=1;dashed=1;entryDx=0;entryDy=0;" target="w-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="we4-label" connectable="0" parent="we4" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" value="WebSocket" vertex="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="we5" edge="1" parent="1" source="w-okhttp" style="endArrow=classic;strokeColor=#333333;exitX=0.5;exitY=0;entryX=0.5;entryY=1;curved=1;entryDx=0;entryDy=0;" target="w-server">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="we5-label" connectable="0" parent="we5" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="HTTP" vertex="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="System Architecture" id="kps2fv39zIX1D7pIr4_h">
    <mxGraphModel dx="317" dy="859" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="500" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" value="Claude Watch — System Architecture" vertex="1">
          <mxGeometry height="30" width="400" x="200" y="15" as="geometry" />
        </mxCell>
        <mxCell id="devices-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Devices" vertex="1">
          <mxGeometry height="280" width="220" x="40" y="60" as="geometry" />
        </mxCell>
        <mxCell id="watch" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Galaxy Watch&#xa;(Wear OS)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="95" as="geometry" />
        </mxCell>
        <mxCell id="watch-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Voice recording · Audio playback&#xa;Relays all traffic via phone (DataLayer)" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="140" as="geometry" />
        </mxCell>
        <mxCell id="phone" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Android Phone&#xa;(Relay + Companion)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="185" as="geometry" />
        </mxCell>
        <mxCell id="phone-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Watch relay (DataLayer) · Tailscale VPN&#xa;Text/voice · Creature UI" vertex="1">
          <mxGeometry height="30" width="170" x="65" y="230" as="geometry" />
        </mxCell>
        <mxCell id="dashboard" parent="1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Web Dashboard&#xa;(Vue.js 3)" vertex="1">
          <mxGeometry height="45" width="170" x="65" y="275" as="geometry" />
        </mxCell>
        <mxCell id="server-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="Server (Python)" vertex="1">
          <mxGeometry height="380" width="220" x="320" y="60" as="geometry" />
        </mxCell>
        <mxCell id="http" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="HTTP Server&#xa;:5566" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="95" as="geometry" />
        </mxCell>
        <mxCell id="http-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="/transcribe · /api/message&#xa;/api/config · /api/response · /api/audio" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="140" as="geometry" />
        </mxCell>
        <mxCell id="ws" parent="1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="WebSocket Server&#xa;:5567" vertex="1">
          <mxGeometry height="45" width="170" x="345" y="175" as="geometry" />
        </mxCell>
        <mxCell id="ws-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="state · chat · history&#xa;permission · usage" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="220" as="geometry" />
        </mxCell>
        <mxCell id="wrapper" parent="1" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Claude Wrapper" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="260" as="geometry" />
        </mxCell>
        <mxCell id="wrapper-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Persistent process · JSON streaming&#xa;Callback system · Context tracking" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="300" as="geometry" />
        </mxCell>
        <mxCell id="hook" parent="1" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;" value="Permission Hook" vertex="1">
          <mxGeometry height="40" width="170" x="345" y="335" as="geometry" />
        </mxCell>
        <mxCell id="hook-detail" parent="1" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="PreToolUse · Auto-approve safe ops&#xa;Route sensitive tools to user" vertex="1">
          <mxGeometry height="25" width="170" x="345" y="375" as="geometry" />
        </mxCell>
        <mxCell id="claude-bg" parent="1" style="rounded=1;fillColor=#ede7f6;strokeColor=#000000;strokeWidth=1;dashed=1;" value="" vertex="1">
          <mxGeometry height="100" width="180" x="600" y="230" as="geometry" />
        </mxCell>
        <mxCell id="claude" parent="1" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=11;align=center;whiteSpace=wrap;fontStyle=1;" value="Claude Code&#xa;(CLI Process)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="245" as="geometry" />
        </mxCell>
        <mxCell id="claude-detail" parent="1" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" value="Tools: Bash, Read, Write,&#xa;Edit, Grep, Glob..." vertex="1">
          <mxGeometry height="30" width="140" x="620" y="290" as="geometry" />
        </mxCell>
        <mxCell id="ext-bg" parent="1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;fontSize=12;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" value="External Services" vertex="1">
          <mxGeometry height="150" width="180" x="600" y="60" as="geometry" />
        </mxCell>
        <mxCell id="deepgram-stt" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram STT&#xa;(Speech → Text)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="90" as="geometry" />
        </mxCell>
        <mxCell id="deepgram-tts" parent="1" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="Deepgram TTS&#xa;(Text → Speech)" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="145" as="geometry" />
        </mxCell>
        <mxCell id="tmux" parent="1" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="tmux session&#xa;claude-watch" vertex="1">
          <mxGeometry height="40" width="140" x="620" y="365" as="geometry" />
        </mxCell>
        <mxCell id="e1" edge="1" parent="1" source="watch" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="http">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e1-label" connectable="0" parent="e1" style="edgeLabel;fontSize=9;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="DataLayer (BT)" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e1b" edge="1" parent="1" source="phone" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="http">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2" edge="1" parent="1" source="watch" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.3;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2-label" connectable="0" parent="e2" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" value="DataLayer relay" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2b" edge="1" parent="1" source="phone" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=0.7;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e2c" edge="1" parent="1" source="dashboard" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.5;entryX=0;entryY=1;curved=1;strokeWidth=1;dashed=1;" target="ws">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3" edge="1" parent="1" source="http" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.2;entryX=0;entryY=0.5;curved=1;" target="deepgram-stt">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e3-label" connectable="0" parent="e3" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="audio" vertex="1">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" edge="1" parent="1" source="http" style="endArrow=classic;strokeColor=#333333;exitX=1;exitY=0.8;entryX=0;entryY=0.5;curved=1;" target="deepgram-tts">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e4-label" connectable="0" parent="e4" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="text" vertex="1">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" edge="1" parent="1" source="wrapper" style="endArrow=classic;startArrow=classic;strokeColor=#333333;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=1;" target="claude">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e5-label" connectable="0" parent="e5" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" value="JSON stdin/stdout" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" edge="1" parent="1" source="hook" style="endArrow=classic;startArrow=classic;strokeColor=#e53935;exitX=0.5;exitY=0;entryX=0.5;entryY=1;curved=0;dashed=1;" target="wrapper">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e6-label" connectable="0" parent="e6" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#e53935;" value="PreToolUse" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" edge="1" parent="1" source="wrapper" style="endArrow=classic;strokeColor=#999999;exitX=1;exitY=1;entryX=0;entryY=0.5;curved=1;dashed=1;" target="tmux">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e7-label" connectable="0" parent="e7" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#999999;" value="output log" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-bg" parent="1" style="rounded=1;fillColor=#fafafa;strokeColor=#cccccc;strokeWidth=1;" value="" vertex="1">
          <mxGeometry height="75" width="220" x="40" y="365" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" parent="1" style="text;fontSize=10;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#333333;" value="State Flow" vertex="1">
          <mxGeometry height="15" width="100" x="50" y="370" as="geometry" />
        </mxCell>
        <mxCell id="legend-flow" parent="1" style="text;fontSize=9;align=left;fillColor=none;strokeColor=none;fontColor=#666666;whiteSpace=wrap;" value="idle → listening → thinking → speaking → idle&#xa;&#xa;Broadcast to all clients via WebSocket" vertex="1">
          <mxGeometry height="45" width="200" x="50" y="388" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Phone App Architecture" id="FH45u9lO-TYO0XZusXpB">
    <mxGraphModel dx="900" dy="620" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="900" pageHeight="620" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="p-title" value="Phone App — Internal Architecture" style="text;fontSize=18;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="220" y="15" width="400" height="30" as="geometry" />
        </mxCell>
        <!-- MainActivity -->
        <mxCell id="p-main-bg" value="" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="250" y="55" width="340" height="125" as="geometry" />
        </mxCell>
        <mxCell id="p-main" value="MainActivity" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=13;fontStyle=1;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="340" y="65" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-main-detail" value="Orchestrates all components&#xa;ViewBinding · LifecycleScope · Coroutines" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="290" y="100" width="260" height="25" as="geometry" />
        </mxCell>
        <mxCell id="p-main-feat" value="sendTextMessage() · sendAudioToServer()&#xa;respondToPrompt() · respondToPermission()&#xa;updateCreatureState() · retryMessage()" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#999999;" vertex="1" parent="1">
          <mxGeometry x="290" y="125" width="260" height="45" as="geometry" />
        </mxCell>
        <!-- UI Layer -->
        <mxCell id="p-ui-bg" value="UI Layer" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="210" width="370" height="190" as="geometry" />
        </mxCell>
        <mxCell id="p-creature" value="CreatureView" style="rounded=1;fillColor=#ffcc80;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="55" y="240" width="130" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-creature-d" value="Custom View · Canvas drawing&#xa;Breathing, blink, bounce anims&#xa;States: idle/listen/think/speak/sleep/offline" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="35" y="275" width="170" height="40" as="geometry" />
        </mxCell>
        <mxCell id="p-chat-adapter" value="ChatAdapter" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="215" y="240" width="130" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-chat-d" value="ListAdapter + DiffUtil&#xa;User/Claude view types&#xa;Pending/Failed status + retry" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="200" y="275" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="p-prompt-ui" value="Prompt / Permission UI" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="55" y="325" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-prompt-d" value="Dynamic option buttons&#xa;Tool name + context display" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="55" y="360" width="160" height="25" as="geometry" />
        </mxCell>
        <mxCell id="p-context-bar" value="Context Bar" style="rounded=1;fillColor=#b3e5fc;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="240" y="325" width="130" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-context-d" value="Token usage %&#xa;Color: green → orange → red" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="235" y="360" width="140" height="25" as="geometry" />
        </mxCell>
        <!-- Network Layer -->
        <mxCell id="p-net-bg" value="Network Layer" style="rounded=1;fillColor=#e8f5e9;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="450" y="210" width="200" height="190" as="geometry" />
        </mxCell>
        <mxCell id="p-ws" value="WebSocketClient" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="470" y="240" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-ws-d" value="OkHttp WebSocket&#xa;Auto-reconnect (5s delay)&#xa;30s ping interval" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="470" y="275" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="p-flows" value="StateFlows" style="rounded=1;fillColor=#c8e6c9;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="470" y="325" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-flows-d" value="connectionStatus · claudeState&#xa;chatMessages · currentPrompt&#xa;contextUsage" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="470" y="360" width="160" height="40" as="geometry" />
        </mxCell>
        <!-- Input Layer -->
        <mxCell id="p-input-bg" value="Input" style="rounded=1;fillColor=#f3e5f5;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="420" width="240" height="105" as="geometry" />
        </mxCell>
        <mxCell id="p-text-input" value="Text Input" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="55" y="445" width="95" height="30" as="geometry" />
        </mxCell>
        <mxCell id="p-text-d" value="EditText + Send btn&#xa;IME_ACTION_SEND" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="45" y="475" width="115" height="25" as="geometry" />
        </mxCell>
        <mxCell id="p-voice" value="Voice Input" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="165" y="445" width="95" height="30" as="geometry" />
        </mxCell>
        <mxCell id="p-voice-d" value="Hold-to-record&#xa;MediaRecorder → m4a" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="155" y="475" width="115" height="25" as="geometry" />
        </mxCell>
        <!-- Utility -->
        <mxCell id="p-util-bg" value="Utility" style="rounded=1;fillColor=#fafafa;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="310" y="420" width="340" height="105" as="geometry" />
        </mxCell>
        <mxCell id="p-kiosk" value="KioskManager" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="325" y="445" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="p-kiosk-d" value="Immersive fullscreen&#xa;3x corner-tap to exit" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="320" y="475" width="130" height="25" as="geometry" />
        </mxCell>
        <mxCell id="p-settings" value="SettingsActivity" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="460" y="445" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="p-settings-d" value="Server address&#xa;Kiosk · Auto-retry prefs" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="450" y="475" width="140" height="25" as="geometry" />
        </mxCell>
        <!-- Pending Messages -->
        <mxCell id="p-pending" value="Pending Messages&#xa;MutableStateFlow" style="rounded=1;fillColor=#fff9c4;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="680" y="240" width="140" height="35" as="geometry" />
        </mxCell>
        <mxCell id="p-pending-d" value="Queue unsent messages&#xa;Retry on reconnect&#xa;Merge with server msgs" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="680" y="275" width="140" height="40" as="geometry" />
        </mxCell>
        <!-- Server (external) -->
        <mxCell id="p-server" value="Server&#xa;HTTP :5566 / WS :5567" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="100" width="140" height="45" as="geometry" />
        </mxCell>
        <!-- OkHttp -->
        <mxCell id="p-okhttp" value="OkHttpClient" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" vertex="1" parent="1">
          <mxGeometry x="700" y="345" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="p-okhttp-d" value="POST /transcribe&#xa;POST /api/message&#xa;POST /api/permission/respond" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="690" y="375" width="140" height="35" as="geometry" />
        </mxCell>
        <!-- Edges -->
        <mxCell id="pe1" style="endArrow=classic;strokeColor=#333333;exitX=0.5;exitY=1;entryX=0.5;entryY=0;curved=0;" edge="1" source="p-main" target="p-creature" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe2" style="endArrow=classic;strokeColor=#333333;exitX=0.5;exitY=1;entryX=0.5;entryY=0;curved=0;" edge="1" source="p-main" target="p-chat-adapter" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe3" style="endArrow=classic;strokeColor=#333333;exitX=0.8;exitY=1;entryX=0.5;entryY=0;curved=1;" edge="1" source="p-main" target="p-ws" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe3-label" value="collectLatest" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" vertex="1" connectable="0" parent="pe3">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pe4" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=0.5;exitY=0;entryX=1;entryY=0.5;curved=1;dashed=1;" edge="1" source="p-ws" target="p-server" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe4-label" value="WebSocket" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" vertex="1" connectable="0" parent="pe4">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pe5" style="endArrow=classic;strokeColor=#333333;exitX=0.5;exitY=0;entryX=0.5;entryY=1;curved=1;" edge="1" source="p-okhttp" target="p-server" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe5-label" value="HTTP" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" vertex="1" connectable="0" parent="pe5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pe6" style="endArrow=classic;strokeColor=#999999;exitX=1;exitY=0.5;entryX=0;entryY=0.5;curved=0;dashed=1;" edge="1" source="p-flows" target="p-pending" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pe6-label" value="combine()" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#999999;" vertex="1" connectable="0" parent="pe6">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pe7" style="endArrow=classic;strokeColor=#333333;exitX=0.2;exitY=1;entryX=0.5;entryY=0;curved=1;" edge="1" source="p-main" target="p-prompt-ui" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Watch App Architecture" id="xmvaHTQZnp6NkHkhcf5A">
    <mxGraphModel dx="900" dy="620" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="900" pageHeight="620" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="w-title" value="Watch App — Internal Architecture" style="text;fontSize=18;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="220" y="15" width="400" height="30" as="geometry" />
        </mxCell>
        <!-- MainActivity -->
        <mxCell id="w-main-bg" value="" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="230" y="55" width="380" height="125" as="geometry" />
        </mxCell>
        <mxCell id="w-main" value="MainActivity" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;fontSize=13;fontStyle=1;align=center;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="340" y="65" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="w-main-detail" value="Activity · Orchestrates all components&#xa;CoroutineScope · collectFlows()" style="text;fontSize=9;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="290" y="100" width="260" height="25" as="geometry" />
        </mxCell>
        <mxCell id="w-main-feat" value="toggleRecording() · stopRecordingAndSend()&#xa;fetchAudioForRequest() · downloadAndPlayAudio()&#xa;showPrompt() · respondToPermission() · sendAck()" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#999999;" vertex="1" parent="1">
          <mxGeometry x="270" y="125" width="300" height="45" as="geometry" />
        </mxCell>
        <!-- Voice / Recording -->
        <mxCell id="w-rec-bg" value="Voice Recording" style="rounded=1;fillColor=#ffcdd2;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="210" width="190" height="130" as="geometry" />
        </mxCell>
        <mxCell id="w-recorder" value="MediaRecorder" style="rounded=1;fillColor=#ef9a9a;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="60" y="240" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-rec-d" value="AAC / MPEG-4 @ 44.1kHz&#xa;128kbps · Temp .m4a file&#xa;Record button toggles state" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="50" y="275" width="170" height="45" as="geometry" />
        </mxCell>
        <!-- Audio Playback -->
        <mxCell id="w-play-bg" value="Audio Playback" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="365" width="190" height="130" as="geometry" />
        </mxCell>
        <mxCell id="w-player" value="MediaPlayer" style="rounded=1;fillColor=#90caf9;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="60" y="395" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-play-d" value="Download MP3 from server&#xa;Replay / Pause / Done controls&#xa;ACK sent on completion" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="50" y="430" width="170" height="45" as="geometry" />
        </mxCell>
        <!-- UI Components -->
        <mxCell id="w-ui-bg" value="UI Components" style="rounded=1;fillColor=#e8f5e9;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="265" y="210" width="200" height="285" as="geometry" />
        </mxCell>
        <mxCell id="w-state-pill" value="State Indicator Pill" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="285" y="240" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-state-d" value="RECORDING (red) · THINKING (orange)&#xa;SPEAKING (blue) · hidden when idle" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="275" y="270" width="180" height="25" as="geometry" />
        </mxCell>
        <mxCell id="w-chat" value="WatchChatAdapter" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="285" y="305" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-chat-d" value="WearableRecyclerView&#xa;Overlapping bubbles (-6dp)&#xa;Thinking dots indicator" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="275" y="335" width="180" height="35" as="geometry" />
        </mxCell>
        <mxCell id="w-prompt" value="Prompt Overlay" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="285" y="380" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-prompt-d" value="Permission Allow/Deny&#xa;Dynamic option buttons&#xa;Fade-in animation + haptics" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="275" y="410" width="180" height="35" as="geometry" />
        </mxCell>
        <mxCell id="w-anim" value="Animations" style="rounded=1;fillColor=#c8e6c9;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" vertex="1" parent="1">
          <mxGeometry x="285" y="455" width="160" height="25" as="geometry" />
        </mxCell>
        <mxCell id="w-anim-d" value="animateIn/Out · fadeIn/Out · OvershootInterpolator" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="275" y="480" width="180" height="15" as="geometry" />
        </mxCell>
        <!-- Network Layer -->
        <mxCell id="w-net-bg" value="Network Layer" style="rounded=1;fillColor=#f3e5f5;strokeColor=#000000;strokeWidth=1;fontSize=11;fontStyle=1;verticalAlign=top;align=left;spacingLeft=8;spacingTop=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="210" width="200" height="190" as="geometry" />
        </mxCell>
        <mxCell id="w-ws" value="WatchWebSocketClient" style="rounded=1;fillColor=#ce93d8;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="515" y="240" width="170" height="35" as="geometry" />
        </mxCell>
        <mxCell id="w-ws-d" value="OkHttp WebSocket&#xa;Auto-reconnect (5s)&#xa;30s ping interval" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="520" y="275" width="160" height="35" as="geometry" />
        </mxCell>
        <mxCell id="w-flows" value="StateFlows" style="rounded=1;fillColor=#e1bee7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="515" y="320" width="170" height="35" as="geometry" />
        </mxCell>
        <mxCell id="w-flows-d" value="connectionStatus · claudeState&#xa;chatMessages · currentPrompt&#xa;contextUsage" style="text;fontSize=8;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="520" y="355" width="160" height="40" as="geometry" />
        </mxCell>
        <!-- Data Models -->
        <mxCell id="w-models" value="Models.kt" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;" vertex="1" parent="1">
          <mxGeometry x="515" y="420" width="170" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-models-d" value="ChatMessage · ClaudeState · ContextUsage&#xa;ClaudePrompt · PromptOption · ConnectionStatus" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="505" y="450" width="190" height="25" as="geometry" />
        </mxCell>
        <!-- Server (external) -->
        <mxCell id="w-server" value="Server&#xa;HTTP :5566 / WS :5567" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="720" y="100" width="140" height="45" as="geometry" />
        </mxCell>
        <!-- OkHttp -->
        <mxCell id="w-okhttp" value="OkHttpClient" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" vertex="1" parent="1">
          <mxGeometry x="730" y="260" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-okhttp-d" value="POST /transcribe (audio)&#xa;GET /api/response&#xa;GET /api/audio&#xa;POST /api/permission/respond&#xa;POST /api/response/ack" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="715" y="290" width="150" height="55" as="geometry" />
        </mxCell>
        <!-- Haptics -->
        <mxCell id="w-haptics" value="Vibrator (Haptics)" style="rounded=1;fillColor=#fff9c4;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" vertex="1" parent="1">
          <mxGeometry x="730" y="370" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-haptics-d" value="Record start/stop&#xa;Permission prompt&#xa;Error patterns" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="725" y="400" width="130" height="35" as="geometry" />
        </mxCell>
        <!-- Settings -->
        <mxCell id="w-settings" value="SettingsActivity" style="rounded=1;fillColor=#e0e0e0;strokeColor=#000000;strokeWidth=1;fontSize=9;align=center;" vertex="1" parent="1">
          <mxGeometry x="730" y="455" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="w-settings-d" value="Server IP + Port&#xa;SharedPreferences" style="text;fontSize=7;align=center;fillColor=none;strokeColor=none;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="730" y="485" width="120" height="20" as="geometry" />
        </mxCell>
        <!-- Edges -->
        <mxCell id="we1" style="endArrow=classic;strokeColor=#333333;exitX=0.2;exitY=1;entryX=0.5;entryY=0;curved=1;" edge="1" source="w-main" target="w-recorder" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="we2" style="endArrow=classic;strokeColor=#333333;exitX=0.5;exitY=1;entryX=0.5;entryY=0;curved=0;" edge="1" source="w-main" target="w-state-pill" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="we3" style="endArrow=classic;strokeColor=#333333;exitX=0.8;exitY=1;entryX=0.5;entryY=0;curved=1;" edge="1" source="w-main" target="w-ws" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="we3-label" value="collectFlows()" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" vertex="1" connectable="0" parent="we3">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="we4" style="endArrow=classic;startArrow=classic;strokeColor=#0099FF;exitX=1;exitY=0.3;entryX=0;entryY=0.5;curved=1;dashed=1;" edge="1" source="w-ws" target="w-server" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="we4-label" value="WebSocket" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#0099FF;" vertex="1" connectable="0" parent="we4">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="we5" style="endArrow=classic;strokeColor=#333333;exitX=0.5;exitY=0;entryX=1;entryY=0.7;curved=1;" edge="1" source="w-okhttp" target="w-server" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="we5-label" value="HTTP" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#666666;" vertex="1" connectable="0" parent="we5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="we6" style="endArrow=classic;strokeColor=#333333;exitX=0.2;exitY=1;entryX=0.5;entryY=0;curved=1;" edge="1" source="w-main" target="w-player" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Phone Relay Architecture" id="relay-arch-001">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="600" math="0" shadow="0">
      <root>
        <mxCell id="r0" />
        <mxCell id="r1" parent="r0" />
        <mxCell id="r-title" parent="r1" style="text;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;fillColor=none;strokeColor=none;fontColor=#333333;" value="Phone Relay Architecture" vertex="1">
          <mxGeometry height="30" width="400" x="210" y="20" as="geometry" />
        </mxCell>
        <mxCell id="r-watch-bg" parent="r1" style="rounded=1;fillColor=#e3f2fd;strokeColor=#000000;strokeWidth=1;dashed=1;fontSize=11;fontStyle=1;verticalAlign=top;align=center;" value="Galaxy Watch (Wear OS)" vertex="1">
          <mxGeometry height="200" width="180" x="30" y="80" as="geometry" />
        </mxCell>
        <mxCell id="r-relay-client" parent="r1" style="rounded=1;fillColor=#bbdefb;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="RelayClient&#xa;(singleton)" vertex="1">
          <mxGeometry height="35" width="150" x="45" y="115" as="geometry" />
        </mxCell>
        <mxCell id="r-relay-msg-svc" parent="r1" style="rounded=1;fillColor=#bbdefb;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="RelayMessageService&#xa;(WearableListenerService)" vertex="1">
          <mxGeometry height="35" width="150" x="45" y="160" as="geometry" />
        </mxCell>
        <mxCell id="r-watch-ws" parent="r1" style="rounded=1;fillColor=#bbdefb;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="WatchWebSocketClient&#xa;(uses relay)" vertex="1">
          <mxGeometry height="35" width="150" x="45" y="205" as="geometry" />
        </mxCell>
        <mxCell id="r-datalayer" parent="r1" style="rounded=1;fillColor=#c8e6c9;strokeColor=#2e7d32;strokeWidth=2;fontSize=11;fontStyle=1;align=center;whiteSpace=wrap;" value="Wearable DataLayer API&#xa;MessageClient + ChannelClient&#xa;(Bluetooth)" vertex="1">
          <mxGeometry height="55" width="200" x="250" y="160" as="geometry" />
        </mxCell>
        <mxCell id="r-phone-bg" parent="r1" style="rounded=1;fillColor=#fff3e0;strokeColor=#000000;strokeWidth=1;dashed=1;fontSize=11;fontStyle=1;verticalAlign=top;align=center;" value="Android Phone (Relay + Companion)" vertex="1">
          <mxGeometry height="200" width="180" x="490" y="80" as="geometry" />
        </mxCell>
        <mxCell id="r-phone-relay" parent="r1" style="rounded=1;fillColor=#ffe0b2;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="PhoneRelayService&#xa;(WearableListenerService)" vertex="1">
          <mxGeometry height="35" width="150" x="505" y="115" as="geometry" />
        </mxCell>
        <mxCell id="r-ws-mgr" parent="r1" style="rounded=1;fillColor=#ffe0b2;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="RelayWebSocketManager&#xa;(OkHttp WebSocket)" vertex="1">
          <mxGeometry height="35" width="150" x="505" y="160" as="geometry" />
        </mxCell>
        <mxCell id="r-phone-http" parent="r1" style="rounded=1;fillColor=#ffe0b2;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="OkHttp Client&#xa;(HTTP relay)" vertex="1">
          <mxGeometry height="35" width="150" x="505" y="205" as="geometry" />
        </mxCell>
        <mxCell id="r-tailscale" parent="r1" style="rounded=1;fillColor=#e8eaf6;strokeColor=#3f51b5;strokeWidth=2;fontSize=11;fontStyle=1;align=center;whiteSpace=wrap;" value="Tailscale VPN&#xa;198.51.100.1" vertex="1">
          <mxGeometry height="45" width="160" x="420" y="320" as="geometry" />
        </mxCell>
        <mxCell id="r-server-bg" parent="r1" style="rounded=1;fillColor=#fffde7;strokeColor=#000000;strokeWidth=1;dashed=1;fontSize=11;fontStyle=1;verticalAlign=top;align=center;" value="Server (Python)" vertex="1">
          <mxGeometry height="130" width="180" x="620" y="310" as="geometry" />
        </mxCell>
        <mxCell id="r-http-srv" parent="r1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="HTTP :5566&#xa;/transcribe · /api/*" vertex="1">
          <mxGeometry height="35" width="150" x="635" y="340" as="geometry" />
        </mxCell>
        <mxCell id="r-ws-srv" parent="r1" style="rounded=1;fillColor=#a5d6a7;strokeColor=#000000;strokeWidth=1;fontSize=10;align=center;whiteSpace=wrap;" value="WebSocket :5567&#xa;state · chat · permission" vertex="1">
          <mxGeometry height="35" width="150" x="635" y="385" as="geometry" />
        </mxCell>
        <mxCell id="r-e1" edge="1" parent="r1" source="r-relay-client" target="r-datalayer" style="endArrow=classic;startArrow=classic;strokeColor=#2e7d32;strokeWidth=2;curved=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="r-e1-label" connectable="0" parent="r-e1" style="edgeLabel;fontSize=8;fillColor=#ffffff;strokeColor=none;fontColor=#2e7d32;" value="HTTP req/resp&#xa;WS messages&#xa;Audio streams" vertex="1">
          <mxGeometry relative="1" x="-0.1" as="geometry">
            <mxPoint y="-10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="r-e2" edge="1" parent="r1" source="r-datalayer" target="r-phone-relay" style="endArrow=classic;startArrow=classic;strokeColor=#2e7d32;strokeWidth=2;curved=1;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="r-e3" edge="1" parent="r1" source="r-phone-bg" target="r-tailscale" style="endArrow=classic;startArrow=classic;strokeColor=#3f51b5;strokeWidth=2;exitX=0.5;exitY=1;entryX=0.5;entryY=0;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="r-e3-label" connectable="0" parent="r-e3" style="edgeLabel;fontSize=9;fillColor=#ffffff;strokeColor=none;fontColor=#3f51b5;fontStyle=1;" value="Tailscale" vertex="1">
          <mxGeometry relative="1" x="-0.2" as="geometry">
            <mxPoint x="-30" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="r-e4" edge="1" parent="r1" source="r-tailscale" target="r-server-bg" style="endArrow=classic;startArrow=classic;strokeColor=#3f51b5;strokeWidth=2;exitX=1;exitY=0.5;entryX=0;entryY=0.5;">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="r-legend" parent="r1" style="rounded=1;fillColor=#fafafa;strokeColor=#cccccc;strokeWidth=1;" value="" vertex="1">
          <mxGeometry height="110" width="350" x="30" y="320" as="geometry" />
        </mxCell>
        <mxCell id="r-legend-title" parent="r1" style="text;fontSize=10;fontStyle=1;align=left;fillColor=none;strokeColor=none;fontColor=#333333;" value="Message Protocol" vertex="1">
          <mxGeometry height="15" width="200" x="40" y="325" as="geometry" />
        </mxCell>
        <mxCell id="r-legend-text" parent="r1" style="text;fontSize=8;align=left;fillColor=none;strokeColor=none;fontColor=#666666;whiteSpace=wrap;" value="/relay/ws/connect · /relay/ws/disconnect — WS lifecycle&#xa;/relay/ws/message · /relay/ws/status — WS data&#xa;/relay/http/request · /relay/http/response — HTTP relay&#xa;/relay/audio/upload · /relay/audio/download — Audio (ChannelClient)&#xa;&#xa;Watch has no server IP — all traffic via phone relay" vertex="1">
          <mxGeometry height="80" width="330" x="40" y="345" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
