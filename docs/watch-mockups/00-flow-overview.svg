<svg width="1600" height="550" viewBox="0 0 1600 550" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="blueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0099FF"/>
      <stop offset="100%" style="stop-color:#0077CC"/>
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50"/>
      <stop offset="100%" style="stop-color:#388E3C"/>
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666666"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4CAF50"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1600" height="550" fill="#1a1a1a"/>

  <!-- Title -->
  <text x="800" y="35" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="20" font-weight="bold">Claude Watch - User Flow (v2: WebSocket + Chat UI + Wake Word)</text>

  <!-- === SCREEN 1: Idle with Chat === -->
  <g transform="translate(50, 70)">
    <text x="100" y="-10" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="12">1. IDLE</text>
    <circle cx="100" cy="140" r="105" fill="#000000" stroke="#333333" stroke-width="3"/>
    <!-- Connection bar -->
    <circle cx="40" cy="55" r="4" fill="#00cc44"/>
    <text x="50" y="59" fill="#00cc44" font-family="Arial, sans-serif" font-size="8">Connected</text>
    <!-- Settings icon -->
    <circle cx="160" cy="55" r="10" fill="#333333"/>
    <circle cx="160" cy="55" r="4" fill="none" stroke="#ffffff" stroke-width="1.5"/>
    <!-- Chat area -->
    <rect x="30" y="70" width="140" height="90" rx="4" fill="#111111" stroke="#222222"/>
    <!-- User bubble -->
    <rect x="70" y="78" width="90" height="18" rx="8" fill="#2962FF"/>
    <text x="115" y="91" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">what time is it?</text>
    <!-- Claude bubble -->
    <rect x="38" y="102" width="100" height="18" rx="8" fill="#333333"/>
    <text x="88" y="115" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">It's 3:42 PM</text>
    <!-- User bubble -->
    <rect x="55" y="126" width="105" height="18" rx="8" fill="#2962FF"/>
    <text x="107" y="139" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">set a timer for 5 min</text>
    <!-- Record button -->
    <ellipse cx="100" cy="195" rx="30" ry="30" fill="url(#blueGrad)"/>
    <text x="100" y="200" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Record</text>
  </g>

  <!-- Arrow 1->2 -->
  <line x1="260" y1="210" x2="300" y2="210" stroke="#666666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="280" y="200" text-anchor="middle" fill="#666666" font-family="Arial, sans-serif" font-size="9">tap</text>

  <!-- === SCREEN 2: Recording === -->
  <g transform="translate(305, 70)">
    <text x="100" y="-10" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="12">2. RECORDING</text>
    <circle cx="100" cy="140" r="105" fill="#000000" stroke="#333333" stroke-width="3"/>
    <!-- Connection bar -->
    <circle cx="40" cy="55" r="4" fill="#00cc44"/>
    <text x="50" y="59" fill="#00cc44" font-family="Arial, sans-serif" font-size="8">Connected</text>
    <!-- Chat area (dimmed) -->
    <rect x="30" y="70" width="140" height="90" rx="4" fill="#111111" stroke="#222222" opacity="0.5"/>
    <rect x="70" y="78" width="90" height="18" rx="8" fill="#2962FF" opacity="0.5"/>
    <rect x="38" y="102" width="100" height="18" rx="8" fill="#333333" opacity="0.5"/>
    <rect x="55" y="126" width="105" height="18" rx="8" fill="#2962FF" opacity="0.5"/>
    <!-- Recording dots -->
    <circle cx="80" cy="170" r="3" fill="#ff4444"/>
    <circle cx="92" cy="170" r="3" fill="#ff4444"/>
    <circle cx="104" cy="170" r="3" fill="#ff4444"/>
    <!-- Stop button -->
    <ellipse cx="100" cy="195" rx="30" ry="30" fill="#cc0000"/>
    <text x="100" y="192" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Stop</text>
    <text x="100" y="204" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="9" font-weight="bold">&amp; Send</text>
  </g>

  <!-- Arrow 2->3 -->
  <line x1="515" y1="210" x2="555" y2="210" stroke="#666666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="535" y="200" text-anchor="middle" fill="#666666" font-family="Arial, sans-serif" font-size="9">stop</text>

  <!-- === SCREEN 3: Thinking (WebSocket driven) === -->
  <g transform="translate(560, 70)">
    <text x="100" y="-10" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="12">3. THINKING</text>
    <text x="100" y="3" text-anchor="middle" fill="#555555" font-family="Arial, sans-serif" font-size="8">(via WebSocket state)</text>
    <circle cx="100" cy="140" r="105" fill="#000000" stroke="#333333" stroke-width="3"/>
    <!-- Connection bar -->
    <circle cx="40" cy="55" r="4" fill="#00cc44"/>
    <text x="50" y="59" fill="#00cc44" font-family="Arial, sans-serif" font-size="8">Connected</text>
    <!-- Chat area with new user message -->
    <rect x="30" y="70" width="140" height="90" rx="4" fill="#111111" stroke="#222222"/>
    <rect x="38" y="78" width="100" height="18" rx="8" fill="#333333"/>
    <text x="88" y="91" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">It's 3:42 PM</text>
    <rect x="55" y="102" width="105" height="18" rx="8" fill="#2962FF"/>
    <text x="107" y="115" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">set a timer for 5 min</text>
    <rect x="55" y="126" width="105" height="18" rx="8" fill="#2962FF"/>
    <text x="107" y="139" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">check disk space</text>
    <!-- Abort button -->
    <ellipse cx="100" cy="195" rx="30" ry="30" fill="#ff8800"/>
    <text x="100" y="200" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Abort</text>
    <!-- Spinner -->
    <circle cx="100" cy="170" r="6" fill="none" stroke="#333333" stroke-width="2"/>
    <path d="M 100 164 A 6 6 0 0 1 106 170" fill="none" stroke="#33b5e5" stroke-width="2" stroke-linecap="round"/>
  </g>

  <!-- Arrow 3->4 -->
  <line x1="770" y1="210" x2="810" y2="210" stroke="#666666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="790" y="200" text-anchor="middle" fill="#666666" font-family="Arial, sans-serif" font-size="9">WS: chat</text>

  <!-- === SCREEN 4: Response in Chat === -->
  <g transform="translate(815, 70)">
    <text x="100" y="-10" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="12">4. RESPONSE</text>
    <text x="100" y="3" text-anchor="middle" fill="#555555" font-family="Arial, sans-serif" font-size="8">(chat message via WS)</text>
    <circle cx="100" cy="140" r="105" fill="#000000" stroke="#333333" stroke-width="3"/>
    <!-- Connection bar -->
    <circle cx="40" cy="55" r="4" fill="#00cc44"/>
    <text x="50" y="59" fill="#00cc44" font-family="Arial, sans-serif" font-size="8">Connected</text>
    <!-- Chat area with response -->
    <rect x="30" y="70" width="140" height="105" rx="4" fill="#111111" stroke="#222222"/>
    <rect x="55" y="78" width="105" height="18" rx="8" fill="#2962FF"/>
    <text x="107" y="91" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">set a timer for 5 min</text>
    <rect x="38" y="102" width="120" height="18" rx="8" fill="#333333"/>
    <text x="98" y="115" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">Timer set for 5 min.</text>
    <rect x="55" y="126" width="105" height="18" rx="8" fill="#2962FF"/>
    <text x="107" y="139" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">check disk space</text>
    <rect x="38" y="150" width="130" height="18" rx="8" fill="#333333"/>
    <text x="103" y="163" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="7">45GB free on /dev/sda1</text>
    <!-- Record button (back to idle) -->
    <ellipse cx="100" cy="200" rx="28" ry="28" fill="url(#blueGrad)"/>
    <text x="100" y="205" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Record</text>
  </g>

  <!-- Arrow 4->1 (curved back) -->
  <path d="M 1020 210 Q 1045 210, 1045 310 Q 1045 350, 150 350 Q 50 350, 50 280 L 50 250"
        fill="none" stroke="#666666" stroke-width="2" stroke-dasharray="5,3"/>
  <polygon points="50,255 45,265 55,265" fill="#666666"/>
  <text x="540" y="370" text-anchor="middle" fill="#666666" font-family="Arial, sans-serif" font-size="9">ready for next recording</text>

  <!-- === SCREEN 5: Permission Prompt === -->
  <g transform="translate(1100, 70)">
    <text x="100" y="-10" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="12">PROMPT OVERLAY</text>
    <text x="100" y="3" text-anchor="middle" fill="#555555" font-family="Arial, sans-serif" font-size="8">(WS: permission/prompt)</text>
    <circle cx="100" cy="140" r="105" fill="#000000" stroke="#333333" stroke-width="3"/>
    <!-- Semi-transparent overlay -->
    <circle cx="100" cy="140" r="100" fill="#000000" opacity="0.85"/>
    <!-- Permission content -->
    <text x="100" y="75" text-anchor="middle" fill="#ff9900" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Bash</text>
    <text x="100" y="90" text-anchor="middle" fill="#999999" font-family="monospace" font-size="7">rm -rf /tmp/old_logs</text>
    <text x="100" y="108" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="9">Allow this action?</text>
    <!-- Option buttons -->
    <rect x="30" y="120" width="140" height="24" rx="10" fill="#4CAF50"/>
    <text x="100" y="136" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Allow</text>
    <rect x="30" y="152" width="140" height="24" rx="10" fill="#555555"/>
    <text x="100" y="168" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="9">Allow for session</text>
    <rect x="30" y="184" width="140" height="24" rx="10" fill="#F44336"/>
    <text x="100" y="200" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Deny</text>
  </g>

  <!-- === SCREEN 6: Settings === -->
  <g transform="translate(1370, 70)">
    <text x="100" y="-10" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="12">SETTINGS</text>
    <circle cx="100" cy="140" r="105" fill="#000000" stroke="#333333" stroke-width="3"/>
    <text x="100" y="70" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="13" font-weight="bold">Settings</text>
    <!-- IP field -->
    <text x="40" y="90" fill="#888888" font-family="Arial, sans-serif" font-size="9">Server IP</text>
    <rect x="40" y="95" width="120" height="20" rx="3" fill="#1a1a1a" stroke="#444444"/>
    <text x="45" y="109" fill="#ffffff" font-family="monospace" font-size="9">192.168.1.100</text>
    <!-- Port field -->
    <text x="40" y="130" fill="#888888" font-family="Arial, sans-serif" font-size="9">Port</text>
    <rect x="40" y="135" width="120" height="20" rx="3" fill="#1a1a1a" stroke="#444444"/>
    <text x="45" y="149" fill="#ffffff" font-family="monospace" font-size="9">5566</text>
    <!-- Save button -->
    <rect x="50" y="170" width="100" height="28" rx="14" fill="#669900"/>
    <text x="100" y="189" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Save</text>
  </g>

  <!-- Settings arrow from idle -->
  <path d="M 205 95 Q 230 60, 1370 95" fill="none" stroke="#555555" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="780" y="55" text-anchor="middle" fill="#555555" font-family="Arial, sans-serif" font-size="9">settings gear</text>

  <!-- ================================================================ -->
  <!-- WAKE WORD ALTERNATIVE PATH (green, below main flow) -->
  <!-- ================================================================ -->

  <!-- Wake word section background -->
  <rect x="30" y="400" width="1020" height="130" rx="10" fill="#1a2a1a" stroke="#4CAF50" stroke-width="1" opacity="0.6"/>

  <!-- Wake word label -->
  <text x="50" y="425" fill="#4CAF50" font-family="Arial, sans-serif" font-size="13" font-weight="bold">WAKE WORD PATH (phone-initiated)</text>
  <text x="50" y="442" fill="#888888" font-family="Arial, sans-serif" font-size="9">Alternative trigger: phone listens for "hey toadie" via Porcupine, records, and POSTs to server</text>

  <!-- Phone icon -->
  <rect x="70" y="460" width="40" height="60" rx="6" fill="#333333" stroke="#4CAF50" stroke-width="1.5"/>
  <rect x="75" y="468" width="30" height="38" rx="2" fill="#111111"/>
  <circle cx="90" cy="512" r="4" fill="#4CAF50"/>

  <!-- "hey toadie" label -->
  <text x="90" y="455" text-anchor="middle" fill="#4CAF50" font-family="Arial, sans-serif" font-size="9" font-style="italic">"hey toadie"</text>

  <!-- Arrow: phone -> record -->
  <line x1="115" y1="490" x2="160" y2="490" stroke="#4CAF50" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

  <!-- Record state -->
  <rect x="165" y="470" width="80" height="38" rx="8" fill="#4CAF50" opacity="0.2" stroke="#4CAF50" stroke-width="1"/>
  <text x="205" y="486" text-anchor="middle" fill="#4CAF50" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Record</text>
  <text x="205" y="500" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="7">silence detect</text>

  <!-- Arrow: record -> send -->
  <line x1="250" y1="490" x2="295" y2="490" stroke="#4CAF50" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

  <!-- Send state -->
  <rect x="300" y="470" width="100" height="38" rx="8" fill="#FF9800" opacity="0.2" stroke="#FF9800" stroke-width="1"/>
  <text x="350" y="486" text-anchor="middle" fill="#FF9800" font-family="Arial, sans-serif" font-size="9" font-weight="bold">POST /transcribe</text>
  <text x="350" y="500" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="7">audio/mp4</text>

  <!-- Arrow: send -> server processes (joins main flow at thinking) -->
  <line x1="405" y1="490" x2="450" y2="490" stroke="#4CAF50" stroke-width="1.5" marker-end="url(#arrowGreen)"/>

  <!-- Server processes -->
  <rect x="455" y="470" width="100" height="38" rx="8" fill="#2962FF" opacity="0.2" stroke="#2962FF" stroke-width="1"/>
  <text x="505" y="486" text-anchor="middle" fill="#2962FF" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Server</text>
  <text x="505" y="500" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="7">Deepgram + Claude</text>

  <!-- Arrow: server -> watch gets update via WS -->
  <path d="M 560 490 L 610 490 Q 630 490, 630 460 Q 630 340, 660 310 L 660 285"
        fill="none" stroke="#4CAF50" stroke-width="1.5" stroke-dasharray="4,3"/>
  <polygon points="660,290 655,300 665,300" fill="#4CAF50"/>
  <text x="680" y="340" fill="#4CAF50" font-family="Arial, sans-serif" font-size="8">WS: state</text>
  <text x="680" y="352" fill="#4CAF50" font-family="Arial, sans-serif" font-size="8">+ chat</text>

  <!-- Overlay note -->
  <rect x="720" y="460" width="310" height="55" rx="8" fill="#252525" stroke="#555555" stroke-width="1"/>
  <text x="875" y="478" text-anchor="middle" fill="#4CAF50" font-family="Arial, sans-serif" font-size="9" font-weight="bold">Phone shows fullscreen wake word overlay:</text>
  <text x="875" y="492" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="9">Creature (LISTENING/THINKING) + audio wave + status</text>
  <text x="875" y="506" text-anchor="middle" fill="#888888" font-family="Arial, sans-serif" font-size="9">Overlay closes on DONE, Porcupine restarts</text>

  <!-- Main flow legend -->
  <g transform="translate(50, 530)">
    <text x="0" y="0" fill="#888888" font-family="Arial, sans-serif" font-size="10">Main flow: Record -> POST /transcribe -> WebSocket pushes state/chat/prompts (no polling) -> Chat UI updates in real-time -> Optional TTS audio on "speaking" state</text>
  </g>

</svg>
