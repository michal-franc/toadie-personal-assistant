name: CI

on:
  pull_request:
    branches: [master]

jobs:
  python:
    name: Python lint & tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Install dependencies
        run: pip install deepgram-sdk aiohttp pytest ruff

      - name: Ruff lint
        run: ruff check *.py

      - name: Ruff format check
        run: ruff format --check *.py

      - name: Run tests
        run: pytest
        env:
          DEEPGRAM_API_KEY: dummy

  watch-app:
    name: Watch app lint & tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - uses: android-actions/setup-android@v3

      - name: Lint
        working-directory: watch-app
        run: ./gradlew lint

      - name: Unit tests
        working-directory: watch-app
        run: ./gradlew test

  phone-app:
    name: Phone app lint & tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - uses: android-actions/setup-android@v3

      - name: Create local.properties
        working-directory: phone-app
        run: echo "porcupine.access_key=" > local.properties

      - name: Lint
        working-directory: phone-app
        run: ./gradlew lint

      - name: Unit tests
        working-directory: phone-app
        run: ./gradlew test
